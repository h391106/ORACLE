-- Active session
SELECT INST_ID, STATUS,　COUNT(*)
FROM GV$SESSION
WHERE TYPE = 'USER'
GROUP BY INST_ID, STATUS
ORDER BY INST_ID, STATUS;

SET LINESIZE 200
COL USERNAME FOR A20
COL SERVICE_NAME FOR A20
SELECT USERNAME, SERVICE_NAME, PROGRAM, MODULE
FROM GV$SESSION
WHERE TYPE = 'USER'
-- AND STATUS = 'ACTIVE'
AND USERNAME NOT IN ('SYS', 'DBSNMP')
ORDER BY USERNAME, SERVICE_NAME, PROGRAM, MODULE;

SELECT INST_ID,　COUNT(*)
FROM GV$SESSION
WHERE TYPE = 'USER'
AND USERNAME NOT IN ('SYS', 'DBSNMP')
GROUP BY INST_ID
ORDER BY INST_ID;

SET LINESIZE 200
COL MACHINE FOR A40
COL PROGRAM FOR A40
COL MODULE FOR A40
COL SERVICE_NAME FOR A20
COL USERNAME FOR A20

SELECT INST_ID, MACHINE,PROGRAM, MODULE, SERVICE_NAME, USERNAME, SID||','||SERIAL# IDENT
FROM GV$SESSION
WHERE TYPE = 'USER'
--AND INST_ID = 6
AND USERNAME NOT IN ('SYS', 'DBSNMP')
AND TYPE = 'USER'
AND STATUS = 'ACTIVE';
-- GROUP BY INST_ID, MACHINE,PROGRAM, MODULE, SERVICE_NAME, USERNAME ;

-- Sessions group by service name
COL INST_ID FOR 999999
COL SERVICE_NAME FOR A20
COL CNT FOR 9999
SELECT INST_ID, SERVICE_NAME, COUNT(*) CNT
FROM GV$SESSION
WHERE TYPE = 'USER'
AND SERVICE_NAME NOT IN ('SYS$USERS')
GROUP BY INST_ID, SERVICE_NAME
ORDER BY INST_ID, SERVICE_NAME;

-- Machines
SELECT MACHINE, USERNAME,　COUNT(*)
FROM GV$SESSION
WHERE TYPE = 'USER'
AND USERNAME NOT IN ('SYS', 'DBSNMP')
-- AND INST_ID = 6
GROUP BY MACHINE, USERNAME;

-- Check the PDB status
COL INST_ID FOR 99999
COL NAME FOR A20
COL OPEN_MODE FOR A20
SELECT INST_ID, NAME, OPEN_MODE
FROM GV$PDBS
WHERE NAME NOT IN ('PDB$SEED')
ORDER BY INST_ID;

-- Free tablespace
SELECT 
DDF.TABLESPACE_NAME, 
TRUNC(SUM(DFS.BYTES)/1024/1024/1024, 2) FREE_GB, 
DDF.ALLOC_GB
FROM
(SELECT TABLESPACE_NAME, 
TRUNC(SUM(BYTES)/1024/1024/1024, 2) ALLOC_GB
FROM DBA_DATA_FILES
WHERE TABLESPACE_NAME = 'SYSAUX'
GROUP BY TABLESPACE_NAME) DDF, DBA_FREE_SPACE DFS
WHERE DDF.TABLESPACE_NAME = DFS.TABLESPACE_NAME
GROUP BY DDF.TABLESPACE_NAME, DDF.ALLOC_GB;


-- DBA_JOBS

SELECT LOG_USER, JOB, WHAT
FROM DBA_JOBS
ORDER BY LOG_USER;


-- DBA_SCHEDULER_JOBS

SELECT OWNER, JOB_NAME
FROM DBA_SCHEDULER_JOBS
WHERE OWNER NOT IN ('SYS')
ORDER BY OWNER;

-- Materialized view
SET LINESIZE 150
COL OWNER FOR A10
COL MVIEW_NAME FOR A30
COL REFRESH_MODE FOR A20
COL REFRESH_METHOD FOR A20
SELECT OWNER, MVIEW_NAME, REFRESH_MODE, REFRESH_METHOD
FROM DBA_MVIEWS;

-- 
SELECT MIN(SAMPLE_TIME) FROM V$ACTIVE_SESSION_HISTORY;

SELECT SAMPLE_ID, SAMPLE_TIME
FROM V$ACTIVE_SESSION_HISTORY
WHERE SAMPLE_TIME BETWEEN TO_DATE('20220604 19:00','YYYYMMDD HH24:MI') AND TO_DATE('20220604 23:00','YYYYMMDD HH24:MI');

DESC DBA_HIST_ACTIVE_SESS_HISTORY

--
SELECT MIN(SAMPLE_ID), MAX(SAMPLE_ID)
FROM DBA_HIST_ACTIVE_SESS_HISTORY
WHERE SAMPLE_TIME BETWEEN TO_DATE('20220604 19:00','YYYYMMDD HH24:MI') AND TO_DATE('20220604 23:00','YYYYMMDD HH24:MI');

--
SELECT INSTANCE_NUMBER, SAMPLE_TIME
FROM DBA_HIST_ACTIVE_SESS_HISTORY
WHERE SAMPLE_ID BETWEEN 46305881 AND 46422837
AND INSTANCE_NUMBER = 1
ORDER BY SAMPLE_TIME ASC;


SELECT SYSDATE FROM DUAL;
SELECT INST_ID,
SUM(CASE WHEN MACHINE LIKE 'wtrhotel%' THEN 1 END) WTRHOTEL,
COUNT(*) TOT
FROM GV$SESSION
GROUP BY INST_ID
ORDER BY INST_ID;

SELECT USERNAME
FROM GV$SESSION
WHERE MACHINE LIKE '&V_MACHINE%'
GROUP BY USERNAME;


-- Count machines
COL MACHINE FOR A50
COL CNT FOR 9999 
SELECT REGEXP_REPLACE(MACHINE, '([0-9]{3})', 'xxx') MACHINE, COUNT(*) CNT
FROM GV$SESSION
WHERE TYPE = 'USER'
AND INST_ID IN ( 1, 2)
GROUP BY REGEXP_REPLACE(MACHINE, '([0-9]{3})', 'xxx')
ORDER BY 1;


-- Search the specific machine
COL MACHINE FOR A50
COL CNT FOR 9999 
SELECT USERNAME, MACHINE, STATUS, SQL_ID
FROM GV$SESSION
WHERE TYPE = 'USER'
AND MACHINE LIKE 'atrrelease%'
ORDER BY 1;

-- Count machines
COL MACHINE FOR A50
COL CNT FOR 9999 
SELECT MACHINE, COUNT(*) CNT
FROM GV$SESSION
WHERE TYPE = 'USER'
AND INST_ID IN ( 7, 8)
AND MACHINE NOT LIKE 'dex%'
AND MACHINE NOT LIKE 'mon-oms%'
AND MACHINE NOT LIKE 'dtrpl%'
GROUP BY MACHINE
ORDER BY 1;

-- Count machines
COL MACHINE FOR A50
COL CNT FOR 9999 
SELECT INST_ID, MACHINE, COUNT(*) CNT
FROM GV$SESSION
WHERE TYPE = 'USER'
AND MACHINE LIKE 'atrmente1%'
GROUP BY INST_ID, MACHINE
ORDER BY 1, 2;

-- Count services
COL INST_ID FOR 9999999
COL SERVICE_NAME FOR A30
COL CNT FOR 9999
SELECT INST_ID, SERVICE_NAME, COUNT(*) CNT
FROM GV$SESSION
WHERE TYPE = 'USER'
AND INST_ID IN ( 7, 8)
GROUP BY INST_ID, SERVICE_NAME
ORDER BY 1,2;

-- ARCHIVE HISTORY
COL NAME FOR A30
SELECT NAME, THREAD#, SEQUENCE#, FIRST_TIME
FROM V$ARCHIVED_LOG
WHERE FIRST_TIME > SYSDATE - 1;

-- Produced archivelog size

COL NAME FOR A30
SELECT NAME, THREAD#, SEQUENCE#, FIRST_TIME, (BLOCK_SIZE * BLOCKS) / 1024 / 1024
FROM V$ARCHIVED_LOG
WHERE FIRST_TIME > SYSDATE - 10
ORDER BY FIRST_TIME ASC;

DESC DBA_HIST_SYSSTAT



SELECT * FROM sys.WRI$_ADV_TASKS where name like 'sqlt%';



3. The error comes since this requires TASK_OWNER to be included -  task_owner => 'APPS'
So original file shows


execute dbms_sqltune.accept_sql_profile(task_name => 'sqlt_s27435_mem', replace => TRUE);

Then edit and add task_owner => 'APPS'
 execute dbms_sqltune.accept_sql_profile(task_name => 'sqlt_s27435_mem', task_owner => 'APPS', replace => TRUE);

